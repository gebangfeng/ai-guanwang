$:
  vscode:
    - docker:
        image: docker.cnb.cool/znb/images/debian:all
      runner:
        cpus: 16
      services:
        - vscode
        - docker
      env:
        HISTFILE: "/root/.cnb/system/zsh_history"
      stages:
        - name: start
          timeout: 24h
          script: |
            current_time=$(date +%s)
            find /workspace/letsfly -mindepth 1 -maxdepth 2 -type d | while read dir
            do
              echo "$dir|1000|$current_time"
            done >> /root/.z
            # default keep live 36000s
            for i in `seq 5760`;do echo $i && date && sleep 10;done
main:
  push:
    - docker:
        # 声明构建环境，可以在 dockerhub 上 https://hub.docker.com/_/maven 找到您需要maven和jdk版本
        # image: maven:3.8.6-openjdk-8
        image: node:20

        volumes:
          # 声明式的构建缓存 https://docs.cnb.cool/grammar/pipeline.html#volumes
          - /root/.m2:copy-on-write
      services:
        # 流水线中启用 docker 服务
        - docker
      stages:
        # 云原生构建自动构建Docker镜像并将它发布到制品库，【上传Docker制品】https://docs.cnb.cool/artifact/docker.html
        - name: docker build
          script:
            - docker build -t ${CNB_DOCKER_REGISTRY}/${CNB_REPO_SLUG_LOWERCASE}:${CNB_COMMIT} .
        - name: docker push
          script:
            - docker push ${CNB_DOCKER_REGISTRY}/${CNB_REPO_SLUG_LOWERCASE}:${CNB_COMMIT}